; ===========================================================
; MULTI-ASPECT RATIO LID-DRIVEN CAVITY SIMULATION
; Geometry: VALUE_WIDTHm wide × VALUE_HEIGHTm tall
; Domain: x ∈ [0, VALUE_WIDTH], y ∈ [0, VALUE_HEIGHT]
; Coupled solver with second-order discretization
; Optimized convergence criteria for low-velocity flows
; ===========================================================

/file/read-case "MESH_FILE"

; ---------- Models ----------
/define/models/viscous/laminar? yes

; ---------- Materials ----------
/define/materials/copy fluid water-liquid

; ---------- Boundary Conditions ----------
; Moving wall (top wall) with velocity VALUE_U
/define/boundary-conditions/wall moving_wall
yes
motion-bc-moving
no
yes
no
no
VALUE_U
VALUE_U
0
no

; Stationary walls (bottom, left, right)
/define/boundary-conditions/wall stationary_walls
no

; ---------- Solution Methods ----------
; Use Coupled solver (enables second-order momentum)
/solve/set/p-v-coupling 24

; Spatial discretization - all second-order
/solve/set/discretization-scheme/pressure 12
/solve/set/discretization-scheme/mom 4

; ---------- Solution Controls ----------
; Relaxed convergence criteria for practical convergence
/solve/monitors/residual/convergence-criteria 1e-6 1e-8 1e-8
/solve/monitors/residual/print? yes

; ---------- Initialization ----------
/solve/initialize/hyb-initialization

; ---------- Solve ----------
; Will stop early if convergence criteria are met
/solve/iterate VALUE_ITERS

; ===========================================================
; POSTPROCESSING - DATA EXPORT
; ===========================================================

/file/write-case-data "VALUE_OUTPUT_DIR/cavity_Re_VALUE_RE.cas.h5" yes

; ========== INTERIOR/VOLUME DATA ==========
/file/export/ascii "VALUE_OUTPUT_DIR/interior_full_Re_VALUE_RE.csv" interior-surface_body () no x-coordinate y-coordinate pressure x-velocity y-velocity velocity-magnitude ()
yes

; ========== MOVING WALL DATA ==========
/file/export/ascii "VALUE_OUTPUT_DIR/moving_wall_full_Re_VALUE_RE.csv" moving_wall () no x-coordinate y-coordinate pressure x-velocity y-velocity velocity-magnitude wall-shear x-wall-shear y-wall-shear ()
yes

; ========== STATIONARY WALLS DATA ==========
/file/export/ascii "VALUE_OUTPUT_DIR/stationary_walls_full_Re_VALUE_RE.csv" stationary_walls () no x-coordinate y-coordinate pressure x-velocity y-velocity velocity-magnitude wall-shear x-wall-shear y-wall-shear ()
yes

; ========== CENTERLINE PROFILES ==========
; Create centerline surfaces at geometric center
; Vertical centerline: at x=WIDTH/2, from y=0 to y=HEIGHT
/surface/line-surface vertical-centerline VALUE_CENTERLINE_X 0 VALUE_CENTERLINE_X VALUE_HEIGHT

; Horizontal centerline: at y=HEIGHT/2, from x=0 to x=WIDTH  
/surface/line-surface horizontal-centerline 0 VALUE_CENTERLINE_Y VALUE_WIDTH VALUE_CENTERLINE_Y

; Export centerline data
/file/export/ascii "VALUE_OUTPUT_DIR/vertical_centerline_Re_VALUE_RE.csv" vertical-centerline () no x-coordinate y-coordinate pressure x-velocity y-velocity velocity-magnitude ()
yes

/file/export/ascii "VALUE_OUTPUT_DIR/horizontal_centerline_Re_VALUE_RE.csv" horizontal-centerline () no x-coordinate y-coordinate pressure x-velocity y-velocity velocity-magnitude ()
yes


/exit yes
